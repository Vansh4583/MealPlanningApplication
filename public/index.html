<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MealPlanner Dashboard</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="brand">
                <i class="fa-solid fa-leaf"></i>
                <span>MealPlanner</span>
            </div>
            
            <nav>
                <div class="nav-label">Core Data</div>
                <button class="nav-btn active" onclick="showTab('dashboard-view')">
                    <i class="fa-solid fa-server"></i> Dashboard & Setup
                </button>
                <button class="nav-btn" onclick="showTab('q5')">
                    <i class="fa-solid fa-users"></i> User Directory
                </button>
                
                <div class="nav-label">Recipes & Meals</div>
                <button class="nav-btn" onclick="showTab('q4')">
                    <i class="fa-solid fa-magnifying-glass"></i> Search Recipes
                </button>
                <button class="nav-btn" onclick="showTab('q2')">
                    <i class="fa-solid fa-pen-to-square"></i> Manage Recipes
                </button>
                <button class="nav-btn" onclick="showTab('q6')">
                    <i class="fa-solid fa-carrot"></i> Ingredients
                </button>
                <button class="nav-btn" onclick="showTab('q3')">
                    <i class="fa-solid fa-calendar-days"></i> Meal Plans
                </button>

                <div class="nav-label">Actions</div>
                <button class="nav-btn" onclick="showTab('q1')">
                    <i class="fa-solid fa-user-plus"></i> Follow User
                </button>

                <div class="nav-label">Analytics</div>
                <button class="nav-btn" onclick="showTab('analytics-view')">
                    <i class="fa-solid fa-chart-pie"></i> Reports & Stats
                </button>
            </nav>
        </aside>

        <main class="main-content">
            <header>
                <h2 id="page-title">Dashboard</h2>
                <div class="connection-status">
                    <span id="dbStatus">Checking...</span>
                    <div id="loadingGif" class="spinner"></div>
                </div>
            </header>

            <div class="content-scroll">

                <div id="dashboard-view" class="tab-content active">
                    <div class="card">
                        <h3><i class="fa-solid fa-database"></i> Database Maintenance</h3>
                        <p>Initialize or reset the application data state.</p>
                        <div class="action-row">
                            <button id="setupDatabase" class="btn-primary">
                                <i class="fa-solid fa-rotate"></i> Reset / Initialize Database
                            </button>
                            <span id="setupDatabaseMsg" class="status-msg"></span>
                        </div>
                    </div>
                </div>

                <div id="q1" class="tab-content">
                    <div class="card">
                        <h3>Follow Management</h3>
                        <p>Create relationships between users and meal plans.</p>
                        <form id="insertFollowForm" class="modern-form">
                            <div class="form-group">
                                <label>User ID</label>
                                <input type="number" id="followUsrId" placeholder="e.g. 101" required>
                            </div>
                            <div class="form-group">
                                <label>Meal Plan ID</label>
                                <input type="number" id="followMid" placeholder="e.g. 500" required>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select id="followIsActive">
                                    <option value="1">Active</option>
                                    <option value="0">Inactive</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-primary">Add Follower</button>
                        </form>
                        <div id="insertFollowResult" class="result-box"></div>
                        
                        <div class="table-wrapper">
                            <table id="followTable" class="modern-table">
                                <thead>
                                    <tr><th>User ID</th><th>MealPlan ID</th><th>IsActive</th></tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="q2" class="tab-content">
                    <div class="card">
                        <h3>Edit Recipe Details</h3>
                        <label>Select Recipe to Edit</label>
                        <select id="recipeSelect" class="full-width-select"></select>

                        <form id="updateRecipeForm" class="modern-form mt-4">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>New Name</label>
                                    <input type="text" id="updateRecipeName" placeholder="Keep current">
                                </div>
                                <div class="form-group">
                                    <label>New Difficulty</label>
                                    <input type="text" id="updateRecipeDifficulty" placeholder="Easy, Medium, Hard">
                                </div>
                                <div class="form-group">
                                    <label>New User ID</label>
                                    <input type="number" id="updateRecipeUsrId" placeholder="Keep current">
                                </div>
                            </div>
                            <button type="submit" class="btn-secondary">Update Recipe</button>
                        </form>
                        <div id="updateRecipeResult" class="result-box"></div>
                    </div>
                </div>

                <div id="q3" class="tab-content">
                    <div class="card danger-zone">
                        <h3><i class="fa-solid fa-trash-can"></i> Delete Meal Plan</h3>
                        <p>Warning: This will cascade delete related follow records.</p>
                        <div class="input-group">
                            <input type="number" id="deleteMealPlanId" placeholder="Enter Meal Plan ID">
                            <button id="deleteMealPlanBtn" class="btn-danger">Delete</button>
                        </div>
                        <div id="deleteMealPlanResult" class="result-box"></div>
                    </div>
                    
                    <div class="card mt-4">
                        <h3>Current Meal Plans</h3>
                        <div class="table-wrapper">
                            <table id="mealPlanTable" class="modern-table">
                                <thead>
                                    <tr><th>ID</th><th>Name</th><th>Meals/Week</th><th>Created</th></tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="q4" class="tab-content">
                    <div class="card">
                        <h3>Advanced Recipe Search</h3>
                        <form id="searchRecipesForm" class="search-bar-grid">
                            <select id="searchDifficulty">
                                <option value="">Any Difficulty</option>
                                <option value="Easy">Easy</option>
                                <option value="Medium">Medium</option>
                                <option value="Hard">Hard</option>
                            </select>
                            
                            <select id="searchLogic" class="logic-select">
                                <option value="AND">AND</option>
                                <option value="OR">OR</option>
                            </select>
                            
                            <select id="searchServingTemp">
                                <option value="">Any Temp</option>
                                <option value="Hot">Hot</option>
                                <option value="Cold">Cold</option>
                            </select>

                            <select id="searchLogic2" class="logic-select">
                                <option value="AND">AND</option>
                                <option value="OR">OR</option>
                            </select>

                            <select id="UserID">
                                <option value="">Any Creator</option>
                            </select>
                            
                            <button type="submit" class="btn-primary">Search</button>
                        </form>
                        <div id="searchRecipesResultMsg" class="status-msg"></div>
                        
                        <div class="table-wrapper">
                            <table id="searchRecipesTable" class="modern-table">
                                <thead>
                                    <tr><th>ID</th><th>Name</th><th>Difficulty</th><th>Temp</th><th>UserID</th></tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="q5" class="tab-content">
                    <div class="card">
                        <h3>User Directory</h3>
                        <p>Customize the columns you wish to view.</p>
                        <form id="projectionForm" class="checkbox-group">
                            <label class="custom-checkbox"><input type="checkbox" name="projCol" value="id" checked> <span>ID</span></label>
                            <label class="custom-checkbox"><input type="checkbox" name="projCol" value="name" checked> <span>Name</span></label>
                            <label class="custom-checkbox"><input type="checkbox" name="projCol" value="height"> <span>Height</span></label>
                            <label class="custom-checkbox"><input type="checkbox" name="projCol" value="weight"> <span>Weight</span></label>
                            <button type="submit" class="btn-secondary small-btn">Apply View</button>
                        </form>
                        <div id="projectionResultMsg" class="status-msg"></div>
                        <div class="table-wrapper">
                            <table id="projectionTable" class="modern-table">
                                <thead id="projectionTableHead"></thead>
                                <tbody id="projectionTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="q6" class="tab-content">
                    <div class="card">
                        <h3>Filter by Ingredient</h3>
                        <form id="joinRecipesForm" class="input-group">
                            <select id="ingredientDropdown" required>
                                <option value="">-- Select Ingredient --</option>
                            </select>
                            <button type="submit" class="btn-primary">Find Recipes</button>
                        </form>
                        <div id="joinRecipesResultMsg" class="status-msg"></div>
                        <div class="table-wrapper">
                            <table id="joinRecipesTable" class="modern-table">
                                <thead>
                                    <tr><th>ID</th><th>Name</th><th>Difficulty</th><th>Amount</th><th>Unit</th></tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="analytics-view" class="tab-content">
                    <div class="analytics-grid">
                        
                        <div class="card">
                            <h3><i class="fa-solid fa-clock"></i> Total Prep Times</h3>
                            <button id="sumRecipeTimes" class="btn-outline">Calculate Times</button>
                            <div class="table-wrapper mini-table">
                                <table id="sumRecipeTimesTable" class="modern-table">
                                    <thead><tr><th>ID</th><th>Recipe</th><th>Total Mins</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="card">
                            <h3><i class="fa-solid fa-filter"></i> Low Ingredient Count</h3>
                            <form id="recipeIngredientCountFilter" class="input-group">
                                <input type="number" id="maxRecipeIngredientCount" min="1" placeholder="Max Ingredients">
                                <button type="submit" class="btn-outline">Filter</button>
                            </form>
                            <div class="table-wrapper mini-table">
                                <table id="recipeIngredientCountTable" class="modern-table">
                                    <thead><tr><th>ID</th><th>Name</th><th>Count</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="card full-width-card">
                            <h3><i class="fa-solid fa-chart-line"></i> Efficiency Analysis</h3>
                            <p>Meal plans with fewer than average recipes.</p>
                            <button id="belowAverageRecipeCountMealPlans" class="btn-outline">Run Analysis</button>
                            <div class="table-wrapper">
                                <table id="belowAverageRecipeCountMealPlansTable" class="modern-table">
                                    <thead><tr><th>ID</th><th>Plan Name</th><th>Recipe Count</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="card full-width-card highlight-card">
                            <h3><i class="fa-solid fa-crown"></i> Super Users</h3>
                            <p>Users who follow <strong>every</strong> available meal plan (Division Query).</p>
                            <button id="divisionBtn" class="btn-primary">Identify Super Users</button>
                            <div id="divisionResultMsg" class="status-msg"></div>
                            <div class="table-wrapper">
                                <table id="divisionTable" class="modern-table">
                                    <thead><tr><th>ID</th><th>Name</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script src="scripts.js"></script>
</body>
</html>